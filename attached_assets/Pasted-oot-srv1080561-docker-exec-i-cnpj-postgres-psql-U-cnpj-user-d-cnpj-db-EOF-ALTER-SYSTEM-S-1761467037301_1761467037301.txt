oot@srv1080561:~# docker exec -i cnpj_postgres psql -U cnpj_user -d cnpj_db << 'EOF'
ALTER SYSTEM SET shared_buffers = '4GB';
ALTER SYSTEM SET effective_cache_size = '12GB';
ALTER SYSTEM SET work_mem = '40MB';
ALTER SYSTEM SET maintenance_work_mem = '1600MB';
ALTER SYSTEM SET max_worker_processes = 4;
ALTER SYSTEM SET max_parallel_workers = 4;
ALTER SYSTEM SET max_parallel_workers_per_gather = 2;
ALTER SYSTEM SET random_page_cost = 1.1;
ALTER SYSTEM SET effective_io_concurrency = 200;
ALTER SYSTEM SET wal_buffers = '16MB';
ALTER SYSTEM SET max_wal_size = '2GB';
ALTER SYSTEM SET min_wal_size = '1GB';
ALTER SYSTEM SET checkpoint_completion_target = 0.9;
ALTER SYSTEM SET autovacuum_max_workers = 2;
ALTER SYSTEM SET autovacuum_naptime = '1min';
ALTER SYSTEM SET log_min_duration_statement = 1000;
ALTER SYSTEM SET log_checkpoints = on;
SELECT 'Configurações salvas!' as status;
EOF
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
ALTER SYSTEM
        status
-----------------------
 Configurações salvas!
(1 row)

root@srv1080561:~# docker restart cnpj_postgres
cnpj_postgres
root@srv1080561:~# sleep 5
root@srv1080561:~# docker exec -i cnpj_postgres psql -U cnpj_user -d cnpj_db << 'EOF'
SELECT
    name,
    setting,
    unit,
    CASE
        WHEN unit = '8kB' THEN pg_size_pretty((setting::bigint * 8192)::bigint)
        WHEN unit = 'kB' THEN pg_size_pretty((setting::bigint * 1024)::bigint)
        ELSE setting || ' ' || COALESCE(unit, '')
    END as valor_legivel
FROM pg_settings
WHERE name IN (
    'shared_buffers',
    'effective_cache_size',
    'work_mem',
    'maintenance_work_mem',
    'max_worker_processes',
    'max_parallel_workers'
)
ORDER BY name;
EOF
         name         | setting | unit | valor_legivel
----------------------+---------+------+---------------
 effective_cache_size | 786432  | 8kB  | 6144 MB
 maintenance_work_mem | 524288  | kB   | 512 MB
 max_parallel_workers | 4       |      | 4
 max_worker_processes | 4       |      | 4
 shared_buffers       | 262144  | 8kB  | 2048 MB
 work_mem             | 10485   | kB   | 10 MB
(6 rows)

root@srv1080561:~#